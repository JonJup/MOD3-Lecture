<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Advances in the analysis of multivariate ecological data</title>
    <meta charset="utf-8" />
    <meta name="author" content="Jonathan Jupke" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="libs\sydney.css" type="text/css" />
    <link rel="stylesheet" href="libs\sydney-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Advances in the analysis of multivariate ecological data
## MOD3: Advanced data science
### Jonathan Jupke
### University of Koblenz Landau
### 2021/01/07

---

&lt;style type="text/css"&gt;
.remark-code { font-family: 'Source Code Pro', 'Lucida Console', Monaco, monospace;
                                    font-size: 100%;
                                  }
}
&lt;/style&gt;






&lt;!--TODO abstand zwischen Bullets--&gt;  
&lt;!--# TODO serial slide--&gt;   
&lt;!--# TODO bullet color--&gt;  

# Plan for today 

- What’s new in multivariate analysis?

- mvabund

- Vector GLM/GAM

- Latent Variable Models 

- Copulas 

- Hierarchical Modeling of Species Communities

- Neural Hierarchical Models 


---
class: inverse, center, middle 

# What’s new in multivariate analysis?

---

# ... or what's old

--

brainstrom : What Methods do you know? 

--

- PCA
- RDA
- PERMANOVA
- CA/ CCA
- Random Forests 
- Clustering Methods 

---
# Bi/Triplot


```r
library(vegan)
data(dune)
data(dune.env)
rda_object &lt;- rda(dune ~ ., dune.env)
```

---
# Bi/Triplot

```r
plot(rda_object)
```

&lt;img src="mod3_presentation_files/figure-html/unnamed-chunk-2-1.png" style="display: block; margin: auto;" /&gt;

---
# What do most ordinations have in common? 

--

They are based on some notion of a distance metric

##fixed 
- PCA and RDA: Euclidean 
- CA and CCA: `\(\chi^2\)`-distance

--

##flexible 
- NMDS 
- PCoA
- dbRDA

---
# How does that differ from the univerate and why? 

--

In univariate analyses we mostly use models:
- linear model 
- linear mixed model 
- generalized linear model 
- generalized additive models 

--

`\(\rightarrow\)` why not in multivariate analyses? 

---
class: middle, center

&lt;img src="old_pc.gif" style="display: block; margin: auto;" /&gt;

---
# The idea is old 

The Gaussian response model: 
$$Y_i = ce^{- \frac{(X_i - u)^2}{2t^2}} $$
--
Can be rewritten as a GLM:
`$$Y_i = exp(ln(c) - \frac{u^2}{2t^2} + \frac{u}{t^2}x_i - \frac{1}{2t^2}x^2_i) = exp(b_1 + b_2 x_i + b_3 x_i^2)$$`
--
with 
$$ t = \frac{1}{\sqrt{-2b_3}}; u = \frac{-b_2}{2b_3}; c =     exp(b_1 - \frac{b_2^2}{4b_3})$$ 
--
For M species and Q environmental variables we would need: `\((1+2Q)M\)` parameters. For 10 species and 5 variables 110 parameters.  

---
# Restricted Gaussian Regression 

gradients as linear combinations of measured variables: 

`$$z_i = \Sigma_{p =  1}^Q \alpha_p x_{ip}$$`
--
Plug gradients back into Gaussian regression
`$$Y_i = ce ^{\frac{(z_i - u)^2}{2t^2}}$$` 

Depending on the number of gradients this reduces the number of parameters. 

---
# What is the model-based approach? 

Model-based approaches assume a parametric generative model

Terms are not consistent:  
Roberts (2019) vs. Warton *el al.* (2012) dissagree about wether CA is distance-based

Alternative: algorithm-based (Warton *et al.* 2015) 
Alternative 2: transformation-based  

"*Our constrained ordination model [...]* " Brittain *et al.* (2020)  
"*Many biologist fit CCA models [...]* " Yee (2004) 

---
background-image: url("figures/WWW12_1.png")
background-size: 800px
background-position: 50% 50%

# Are models better? 

&lt;!--now here come the studies: WWW12, Eduard Szösz, me--&gt;
Every distance metric assumes a mean variance relationship  



.footnote[Warton *et al.* (2012)]
---
background-image: url("figures/WWW12_2.png")
background-size: 400px
background-position: 50% 75%

# Are models better? 

Every distance metric assumes a mean variance relationship  



.footnote[Warton *et al.* (2012)]
---
background-image: url("figures/WWW12_3.png")
background-size: 400px
background-position: 50% 75%

# Are models better? 

Every distance metric assumes a mean variance relationship  



.footnote[Warton *et al.* (2012)]
---
background-image: url("figures/szöcs15_1.png")
background-size: 400px
background-position: 50% 75%

# Are models better? 



.footnote[Szöcs *et al.* (2015)]
---
background-image: url("figures/jupke20_1.png")
background-size: 800px
background-position: 50% 50%

# Are models better? 



.footnote[Jupke *et al.* (2020)]
---
class: inverse, center, middle 

# mvabund

---
# mvabund 

R package published in 2012  (Wang et al. 2012)

**M**ulti**v**ariate **Abund**ance data 

Multivariate
- many, possibly correlated responses 

Abundance
- strong mean variance realtionship 

---
# mvabund uses manyglms 

`$$g(\mu_1) ) = L_1 + \epsilon \rightarrow Likelihood\ ratio_1$$`
--
`$$g(\mu_2) ) = L_2 + \epsilon \rightarrow Likelihood\ ratio_2$$`

--
The individual Likelihood ratios indicate the effect on a single species. 

The sum `\(\Sigma LR\)` that on the community. 

---


```r
library(mvabund)
data("Tasmania")
attach(Tasmania)
head(copepods[,1:3])
```

```
##      Ameira Adopsyllus Ectinosoma
## B1D1     43          0          0
## B1D2     63          0          0
## B1U1    124          0          0
## B1U2    105          0          2
## B2D1      4          0          0
## B2D2      5          0          0
```

```r
tasmvabund &lt;- mvabund(copepods)
class(tasmvabund)
```

```
## [1] "mvabund" "matrix"
```
---

```r
plot(tasmvabund~treatment, col = as.numeric(block))
```

```
## 
##  PIPING TO 2nd MVFACTOR
```

&lt;img src="mod3_presentation_files/figure-html/unnamed-chunk-6-1.png" style="display: block; margin: auto;" /&gt;
---

```r
meanvar.plot(copepods~tr.block, col = as.numeric (treatment))
```

```
## START SECTION 2 
## Plotting if overlay is TRUE
```

&lt;img src="mod3_presentation_files/figure-html/unnamed-chunk-7-1.png" style="display: block; margin: auto;" /&gt;

```
## FINISHED SECTION 2
```
---
# Fitting a model 

```r
tas.nb &lt;- manyglm(copepods ~ block*treatment, 
                  family = "negative.binomial")
```


`$$Y_{ij} \sim NB(\mu_{jkl}, \phi_j)$$`
`$$log(\mu_{jkl}) = intercept_j + block_{jkl} + treatment_{jl} + block \times treatment_{jkl}$$`
---
# Checking model assumptions 

```r
plot.manyglm(tas.nb, which = 1)
```

&lt;img src="mod3_presentation_files/figure-html/mvabund Checking model assumptions 1-1.png" style="display: block; margin: auto;" /&gt;
---
# Checking model assumptions

```r
plot.manyglm(tas.nb, which = 2)
```

&lt;img src="mod3_presentation_files/figure-html/mvabund Checking model assumptions 2-1.png" style="display: block; margin: auto;" /&gt;
---
# Checking model assumptions

```r
plot.manyglm(tas.nb, which = 3)
```

&lt;img src="mod3_presentation_files/figure-html/mvabund Checking model assumptions 3-1.png" style="display: block; margin: auto;" /&gt;
---
# Testing Hypotheses


```r
#anova_out &lt;- anova(tas.nb, p.uni = "adjusted")
```
.scroll-box-16[

```r
#anova_out
```
]

---
# Advanced Features


---
class: inverse, center, middle 

# Vector Genralized Models 

---
class: inverse, center, middle 

# Latent Variable Models 

---
class: inverse, center, middle 

# Copulas 

---
class: inverse, center, middle 

# Hierarchical modeling of species communities 

---
class: inverse, center, middle 

# Hierarchical Neural networks 

---
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
