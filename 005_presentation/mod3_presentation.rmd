---
title: "Advances in the analysis of multivariate ecological data"
subtitle: "MOD3:yalla"
author: "Jonathan Jupke"
institute: "University of Koblenz Landau"
date: "2021/01/07"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: ["default", "libs/sydney.css", "libs/sydney-fonts.css"]
    nature:
      countIncrementalSlides: false
---
```{css, echo = FALSE}
.remark-code { font-family: 'Source Code Pro', 'Lucida Console', Monaco, monospace;
                                    font-size: 100%;
                                  }
}
```

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
```




<!--TODO abstand zwischen Bullets-->  
<!--# TODO serial slide-->   
<!--# TODO bullet color-->  

# Plan for today 

- What’s new in multivariate analysis?

- mvabund

- Vector GLM/GAM

- Latent Variable Models 

- Copulas 

- Hierarchical Modeling of Species Communities

- Neural Hierarchical Models 


---
class: inverse, center, middle 

# What’s new in multivariate analysis?

---

# ... or what's old

--

brainstrom : What Methods do you know? 

--

- PCA
- RDA
- PERMANOVA
- CA/ CCA
- Random Forests 
- Clustering Methods 

---
# Bi/Triplot

```{r load vegan, results='hide', echo = T, message = F}
library(vegan)
data(dune)
data(dune.env)
rda_object <- rda(dune ~ ., dune.env)
```

---
# Bi/Triplot
```{r, fig.width = 6, fig.height = 6, fig.align="center"}
plot(rda_object)
```

---
# What do most ordinations have in common? 

--
They are based on some notion of a distance metric
## fixed 
- PCA and RDA: Euclidean 
- CA and CCA: $\chi^2$-distance

--

## flexible 
- NMDS 
- PCoA
- dbRDA

---
# How does that differ from the univerate and why? 

--

In univariate analyses we mostly use models:
- linear model 
- linear mixed model 
- generalized linear model 
- generalized additive models 

--

$\rightarrow$ why not in multivariate analyses? 

---
class: middle, center

```{r, fig.align="center", echo = F}
knitr::include_graphics("old_pc.gif")
```

---
# The idea is old 

Some stuff for Canonical Gaussian Ordination

---
# What is the model-based approach? 

---
# Terminology confusions 


"Our constrained ordination models [...]" [1]  
"Many biologists fit CCA models [...]" [2]

add here that transformation might be an alternative
also algorithm based approach 

.footnote[
[1] Brittain et al. (2020). Freshwater Biology

[2] Yee (2004). Ecological Monographs 
]
---
# Should ecologist prefer the model- to the distance-based approach? 

now here come the studies: WWW12, Eduard Szösz, me, 

---
class: inverse, center, middle 

# mvabund

---
# mvabund 

R package published in 2012  (Wang et al. 2012)

**M**ulti**v**ariate **Abund**ance data 

Multivariate
- many, possibly correlated responses 

Abundance
- strong mean variance realtionship 

---
# mvabund uses manyglms 

$$g(\mu_1) ) = L_1 + \epsilon \rightarrow Likelihood\ ratio_1$$
$$g(\mu_2) ) = L_2 + \epsilon \rightarrow Likelihood\ ratio_2$$
$$g(\mu_3) ) = L_3 + \epsilon \rightarrow Likelihood\ ratio_3$$
$$g(\mu_4) ) = L_4 + \epsilon \rightarrow Likelihood\ ratio_4$$
--
The individual Likelihood ratios indicate the effect on a single species. The sum $\Sigma LR$ that on all. 

---

```{r}
library(mvabund)
data("Tasmania")
attach(Tasmania)
head(copepods[,1:3])
```
```{r}
tasmvabund <- mvabund(copepods)
class(tasmvabund)
```
---
```{r, message = FALSE, fig.align="center", warning=FALSE, fig.height=6}
plot(tasmvabund~treatment, col = as.numeric(block))
```
---
```{r, message = FALSE, warning=FALSE, fig.align="center",  fig.height=7}
meanvar.plot(copepods~tr.block, col = as.numeric (treatment))
```
---
# Fitting a model 
```{r}
tas.nb <- manyglm(copepods ~ block*treatment, 
                  family = "negative.binomial")
```


$$Y_{ij} \sim NB(\mu_{jkl}, \phi_j)$$
$$log(\mu_{jkl}) = intercept_j + block_{jkl} + treatment_{jl} + block \times treatment_{jkl}$$
---
# Checking model assumptions 
```{r mvabund Checking model assumptions 1, fig.align="center", fig.height=6, fig.width=6}
plot.manyglm(tas.nb, which = 1)
```
---
# Checking model assumptions
```{r mvabund Checking model assumptions 2, fig.align="center", fig.height=6, fig.width=6}
plot.manyglm(tas.nb, which = 2)
```
---
# Checking model assumptions
```{r mvabund Checking model assumptions 3, fig.align="center", fig.height=6, fig.width=6}
plot.manyglm(tas.nb, which = 3)
```
---
# Testing Hypotheses

```{r mvabund Testing Hypotheses, comment=""}
#anova_out <- anova(tas.nb, p.uni = "adjusted")
```
.scroll-box-16[
```{r}
#anova_out
```
]

---
class: inverse, center, middle 

# Vector Genralized Models 

---
class: inverse, center, middle 

# Latent Variable Models 

---
class: inverse, center, middle 

# Copulas 

---
class: inverse, center, middle 

# Hierarchical modeling of species communities 

---
class: inverse, center, middle 

# Hierarchical Neural networks 

--- 



